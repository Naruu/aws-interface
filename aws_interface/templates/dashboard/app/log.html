{% extends 'dashboard/app/base.html' %}
{% load staticfiles %}
{% block content %}

    {% load timetags %}
    <div class="main-content">
        <!-- Top navbar -->
        {% include 'dashboard/app/top-navbar.html' %}
        <!-- Header -->
        <input id="view-tag" value="logic" hidden>
        <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
            <div class="container-fluid">
                <div class="header-body">
                    <div class="alert alert-primary" role="alert">
                        <strong>AWS Lambda</strong>  를 사용합니다.
                    </div>

                    <!-- Card stats -->

                </div>
            </div>
        </div>
        <!-- Page content -->
        <div class="container-fluid mt--7">
            <div class="row">
                <div class="col-xl-12">
                    <div class="card shadow">
                        <div class="card-header border-0">
                            <div class="row align-items-center">
                                <div class="col-3">
                                    <h3 class="mb-0">
                                        이벤트 목록
                                    </h3>
                                </div>

                                <div class="col-9">
                                    <form method="get" action="">
                                        <div class="row">
                                            <div class="col-4">
                                                <input name="user_id" type="text" class="form-control form-control-sm" placeholder="OWNER" value="{{ user_id }}">
                                            </div>
                                            <div class="col-3">
                                                <input name="event_source" type="text" class="form-control form-control-sm" placeholder="SOURCE" value="{{ event_source }}">
                                            </div>
                                            <div class="col-3">
                                                <input name="event_name" type="text" class="form-control form-control-sm" placeholder="NAME" value="{{ event_name }}">
                                            </div>

                                            <div class="col-2">
                                                <button type="submit" id="search-event-btn" class="btn btn-sm btn-primary">
                                                    <span class="btn-inner--text" style="color: white;">검색</span>
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                            </div>
                        </div>
                        <div id="log-table" class="table-responsive">
                            <!-- Projects table -->
                            <table class="table align-items-center table-flush">
                                <thead class="thead-light">
                                <tr>
                                    <th scope="col">owner</th>
                                    <th scope="col">createDate</th>
                                    <th scope="col">event_source</th>
                                    <th scope="col">event_name</th>
                                    <th scope="col">event_param</th>
                                </tr>
                                </thead>
                                <tbody>
{#                                {% for log in logs %}#}
{#                                    <tr>#}
{#                                        <th scope="row">#}
{#                                            {{ log.owner }}#}
{#                                        </th>#}
{#                                        <td>#}
{#                                            {{ log.creationDate|to_date }}#}
{#                                        </td>#}
{#                                        <td>#}
{#                                            {{ log.event_source }}#}
{#                                        </td>#}
{#                                        <td>#}
{#                                            {{ log.event_name }}#}
{#                                        </td>#}
{#                                        <td>#}
{#                                            {{ log.event_param }}#}
{#                                        </td>#}
{##}
{#                                    </tr>#}
{#                                {% endfor %}#}

                                </tbody>
                            </table>
                        </div>
                        <button id="load-more-logs-btn" class="btn-primary btn-block rounded-bottom" onclick="load_more_logs();">
                            항목 더보기 +
                        </button>
                    </div>
                </div>
            </div>
            <div class="row mt-7">

            </div>
            <!-- Footer -->
            <footer class="footer">
                <div class="row align-items-center justify-content-xl-between">
                    <div class="col-xl-6">
                        <div class="copyright text-center text-xl-left text-muted">
                            &copy; 2018 <a href="https://aws-interface.com" class="font-weight-bold ml-1" target="_blank">AWS Interface</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <script>
    var logs_end_key = null;
    function load_more_logs(){
            const user_id = '{{ user_id }}';
            const event_source = '{{ event_source }}';
            const event_name = '{{ event_name }}';

            var item = {
                cmd: 'get_logs',
                user_id,
                event_source,
                event_name,
            };

            if (logs_end_key != null){
                item['start_key'] = logs_end_key;
            }
            $.post("", item, function (data) {
                logs_end_key = data['end_key'];
                if (logs_end_key == null){
                    $("#load-more-logs-btn").hide();
                }
                for (var i = 0; i < data['items'].length; i++){
                    const item = data['items'][i];
                    const raw = "<tr>\n" +
                        "<td scope='row'>" + item.owner  + "</td>\n" +
                        "<td>" + item['creation_date'] + "</td>\n" +
                        "<td>" + item.event_source + "</td>\n" +
                        "<td>" + item.event_name + "</td>\n" +
                        "<td>" + item.event_param + "</td>\n" +
                        "</tr>";
                    $("#log-table>table").append(raw);
                }
            });
        }
        window.onload = function () {
            load_more_logs();
        };
    </script>

{% endblock %}